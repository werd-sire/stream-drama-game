import{C as i,P as h}from"./index-c0fuZDJO.js";class o{constructor(e,t,s){if(this.eventManager=e,this.scene=e.scene,this.config=t,this.deadline=s,this.type=t.type,this.elements=[],this.tweens=[],this.timers=[],this.handlers=[],this.layout=e.responsiveLayout||e.scene.responsiveLayout,!this.layout)console.warn("BaseEvent: No ResponsiveLayout available, using fallback"),this.eventSpace={x:i.WIDTH*i.LAYOUT.EVENT_SPACE.x_ratio,y:i.HEIGHT*i.LAYOUT.EVENT_SPACE.y_ratio,width:i.WIDTH*i.LAYOUT.EVENT_SPACE.width_ratio,height:i.HEIGHT*i.LAYOUT.EVENT_SPACE.height_ratio,margin:Math.min(i.WIDTH,i.HEIGHT)*i.LAYOUT.EVENT_SPACE.MARGIN_RATIO};else{const n=this.layout.getLayout();this.eventSpace=n.eventSpace}this.eventArea={x:this.eventSpace.x+this.eventSpace.margin,y:this.eventSpace.y+this.eventSpace.margin,width:this.eventSpace.width-this.eventSpace.margin*2,height:this.eventSpace.height-this.eventSpace.margin*2}}getSafePosition(e,t){const n=h.Math.Between(this.eventArea.x+5,this.eventArea.x+this.eventArea.width-e-5),a=h.Math.Between(this.eventArea.y+5+30,this.eventArea.y+this.eventArea.height-t-5-20);return{x:n,y:a}}createPopup(e=null,t=null,s=null){return console.warn("createPopup is deprecated - events should use full event space"),null}trackElement(e){e&&(this.elements.push(e),e.setDepth&&e.setDepth(20))}trackElements(...e){e.forEach(t=>this.trackElement(t))}trackTween(e){e&&this.tweens.push(e)}trackTimer(e){e&&this.timers.push(e)}trackHandler(e,t,s=null){this.handlers.push({event:e,handler:t,target:s})}createText(e,t,s,n={}){const a=this.scene.add.text(e,t,s,n);return this.trackElement(a),a}createGraphics(){const e=this.scene.add.graphics();return this.trackElement(e),e}createEventTimer(){const e=this.scene.add.rectangle(this.eventArea.x+this.eventArea.width/2,this.eventArea.y+this.eventArea.height-15,100,20,3355443).setStrokeStyle(2,0);this.trackElement(e),this.timerText=this.scene.add.text(this.eventArea.x+this.eventArea.width/2,this.eventArea.y+this.eventArea.height-15,"",{...i.TEXT_STYLES.UI_SMALL,color:"#FFFFFF"}).setOrigin(.5),this.trackElement(this.timerText),this.timerInterval=this.scene.time.addEvent({delay:100,loop:!0,callback:()=>this.updateTimer()}),this.trackTimer(this.timerInterval)}updateTimer(){if(!this.deadline||!this.timerText)return;const e=Math.max(0,this.deadline-this.scene.time.now),t=(e/1e3).toFixed(1);this.timerText.setText(`${t}s`),e<3e3?this.timerText.setColor("#FF0000"):e<5e3&&this.timerText.setColor("#FFFF00")}checkInput(e,t){return!1}cleanup(){this.scene.input&&this.scene.input.mouse&&typeof this.scene.input.mouse.enableContextMenu=="function"&&this.scene.input.mouse.enableContextMenu(),this.tweens.forEach(e=>{e&&e.stop&&e.stop()}),this.timers.forEach(e=>{e&&e.remove&&e.remove()}),this.handlers.forEach(({event:e,handler:t,target:s})=>{s?s.off(e,t):e==="keydown"||e==="keyup"?this.scene.input.keyboard.off(e,t):this.scene.input.off(e,t)}),this.elements.forEach((e,t)=>{e&&e.destroy&&typeof e.destroy=="function"&&this.scene.tweens.add({targets:e,alpha:0,duration:200,delay:t*10,onComplete:()=>{try{e.destroy()}catch(s){console.warn("Error destroying element:",s)}}})}),this.elements=[],this.tweens=[],this.timers=[],this.handlers=[]}start(){this.createEventTimer()}update(e,t){}success(){this.scene.events.emit("event:success"),this.scene.events.emit("event:ended")}fail(){this.scene.events.emit("event:fail"),this.scene.events.emit("event:ended")}timeout(){this.fail()}}export{o as B};
