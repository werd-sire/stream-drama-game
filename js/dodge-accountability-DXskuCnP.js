import{C as n,P as l}from"./index-c0fuZDJO.js";import{B as h}from"./base-event-BLT1_Wdv.js";class p extends h{constructor(t,e,a){super(t,e,a),this.blocksAvoided=0,this.blocks=[],this.particles=[],this.isMovingLeft=!1,this.isMovingRight=!1,this.speedMultiplier=1,this.lastSpawnTime=0,this.gameArea={left:0,right:0,top:0,bottom:0}}start(){this.setupEventSpace(),this.createPlayer(),this.setupControls(),this.startBlockSpawning()}setupEventSpace(){this.gameArea={left:this.eventArea.x+20,right:this.eventArea.x+this.eventArea.width-20,top:this.eventArea.y+30,bottom:this.eventArea.y+this.eventArea.height-30};const t=this.scene.add.graphics();t.fillGradientStyle(1710638,1710638,986906,986906),t.fillRect(this.eventArea.x,this.eventArea.y,this.eventArea.width,this.eventArea.height),t.lineStyle(3,parseInt(this.config.color.replace("#","0x")),1),t.strokeRect(this.eventArea.x,this.eventArea.y,this.eventArea.width,this.eventArea.height),this.trackElement(t);const e=this.scene.add.graphics();e.fillStyle(16711680,.1),e.fillRect(this.gameArea.left,this.gameArea.top,this.gameArea.right-this.gameArea.left,60),this.trackElement(e);const a=this.scene.add.text(this.eventArea.x+this.eventArea.width/2,this.eventArea.y+10,"AVOID RESPONSIBILITY!",{...n.TEXT_STYLES.UI_SMALL,color:this.config.color,stroke:"#000000",strokeThickness:3}).setOrigin(.5);this.trackElement(a),this.progressText=this.scene.add.text(this.eventArea.x+this.eventArea.width/2,this.eventArea.y+this.eventArea.height-15,`Dodged: 0 / ${this.config.blocksToDodge}`,{...n.TEXT_STYLES.MICRO,color:"#00FF00",stroke:"#000000",strokeThickness:2}).setOrigin(.5),this.trackElement(this.progressText),this.instructionText=this.scene.add.text(this.eventArea.x+this.eventArea.width/2,this.eventArea.y+25,"Use â† â†’ or mouse to move",{...n.TEXT_STYLES.MICRO,color:"#AAAAAA"}).setOrigin(.5),this.trackElement(this.instructionText)}createPlayer(){const t=this.eventArea.x+this.eventArea.width/2,e=this.gameArea.bottom-20;this.player=this.scene.add.container(t,e),this.trackElement(this.player);const a=this.scene.add.graphics();a.fillGradientStyle(parseInt(n.COLORS.PRIMARY.replace("#","0x")),parseInt(n.COLORS.PRIMARY.replace("#","0x")),parseInt(n.COLORS.SECONDARY.replace("#","0x")),parseInt(n.COLORS.SECONDARY.replace("#","0x"))),a.fillRoundedRect(-15,-15,30,30,8),a.lineStyle(2,0,1),a.strokeRoundedRect(-15,-15,30,30,8),this.player.add(a);const i=this.scene.add.text(0,-2,"ðŸ˜Ž",{fontSize:"16px"}).setOrigin(.5);this.player.add(i),this.playerTrail=[],this.playerBounds={left:this.gameArea.left+15,right:this.gameArea.right-15}}setupControls(){const t=this.scene.input.keyboard.addKey("LEFT"),e=this.scene.input.keyboard.addKey("RIGHT"),a=this.scene.input.keyboard.addKey("A"),i=this.scene.input.keyboard.addKey("D");t.on("down",()=>this.startMoving("left")),t.on("up",()=>this.stopMoving("left")),e.on("down",()=>this.startMoving("right")),e.on("up",()=>this.stopMoving("right")),a.on("down",()=>this.startMoving("left")),a.on("up",()=>this.stopMoving("left")),i.on("down",()=>this.startMoving("right")),i.on("up",()=>this.stopMoving("right")),this.scene.input.on("pointerdown",o=>{o.y>this.gameArea.top&&o.y<this.gameArea.bottom&&(o.x<this.player.x?this.startMoving("left"):this.startMoving("right"))}),this.scene.input.on("pointerup",()=>{this.stopMoving("both")}),this.scene.input.on("pointermove",o=>{if(o.isDown&&o.y>this.gameArea.top&&o.y<this.gameArea.bottom){const r=l.Math.Clamp(o.x,this.playerBounds.left,this.playerBounds.right)-this.player.x;Math.abs(r)>5?r<0?this.startMoving("left"):this.startMoving("right"):this.stopMoving("both")}})}startMoving(t){t==="left"?(this.isMovingLeft=!0,this.isMovingRight=!1):t==="right"&&(this.isMovingRight=!0,this.isMovingLeft=!1)}stopMoving(t){t==="left"?this.isMovingLeft=!1:t==="right"?this.isMovingRight=!1:t==="both"&&(this.isMovingLeft=!1,this.isMovingRight=!1)}startBlockSpawning(){this.blockTimer=this.scene.time.addEvent({delay:this.config.spawnRate,repeat:this.config.blocksToDodge-1,callback:()=>this.spawnBlock()}),this.trackTimer(this.blockTimer)}spawnBlock(){const t=l.Math.Between(this.gameArea.left+this.config.blockSize/2,this.gameArea.right-this.config.blockSize/2),e=this.scene.add.container(t,this.gameArea.top),a=[{color:16729344,darkColor:13382400,text:"BLAME",fontSize:"6px",emoji:"ðŸ‘‰"},{color:9109504,darkColor:6636321,text:"GASLIGHT",fontSize:"5px",emoji:"ðŸ•¯ï¸"},{color:4286945,darkColor:3034055,text:"DEFLECT",fontSize:"5px",emoji:"ðŸ›¡ï¸"},{color:16737095,darkColor:15029805,text:"DENY",fontSize:"6px",emoji:"ðŸ™ˆ"},{color:9662683,darkColor:8087790,text:"VICTIM",fontSize:"6px",emoji:"ðŸ˜­"},{color:14423100,darkColor:12131388,text:"TWIST",fontSize:"6px",emoji:"ðŸŒªï¸"},{color:16716947,darkColor:13046637,text:"ATTACK",fontSize:"6px",emoji:"âš”ï¸"},{color:3329330,darkColor:2263842,text:"IGNORE",fontSize:"6px",emoji:"ðŸš«"},{color:16747520,darkColor:15102720,text:"JUSTIFY",fontSize:"5px",emoji:"ðŸ¤·"},{color:8388736,darkColor:6697830,text:"MINIMIZE",fontSize:"5px",emoji:"ðŸ“‰"}],i=l.Utils.Array.GetRandom(a),o=l.Math.Between(1,3),s=this.scene.add.graphics();if(o===1)s.fillGradientStyle(i.color,i.color,i.darkColor,i.darkColor),s.fillRoundedRect(-this.config.blockSize/2,-this.config.blockSize/2,this.config.blockSize,this.config.blockSize,3),s.lineStyle(1,0,.8),s.strokeRoundedRect(-this.config.blockSize/2,-this.config.blockSize/2,this.config.blockSize,this.config.blockSize,3);else if(o===2){const r=this.config.blockSize/2.5;s.fillGradientStyle(i.color,i.color,i.darkColor,i.darkColor),s.beginPath(),s.moveTo(-r,0),s.lineTo(-r/2,-r),s.lineTo(r/2,-r),s.lineTo(r,0),s.lineTo(r/2,r),s.lineTo(-r/2,r),s.closePath(),s.fillPath(),s.lineStyle(1,0,.8),s.strokePath()}else{const r=this.config.blockSize/2.2;s.fillGradientStyle(i.color,i.color,i.darkColor,i.darkColor),s.beginPath(),s.moveTo(0,-r),s.lineTo(r,0),s.lineTo(0,r),s.lineTo(-r,0),s.closePath(),s.fillPath(),s.lineStyle(1,0,.8),s.strokePath()}if(e.add(s),Math.random()>.5){const r=this.scene.add.text(0,0,i.text,{fontSize:i.fontSize,color:"#FFFFFF",fontFamily:"Arial",fontWeight:"bold",stroke:"#000000",strokeThickness:1}).setOrigin(.5);e.add(r)}else{const r=this.scene.add.text(0,0,i.emoji,{fontSize:"8px"}).setOrigin(.5);e.add(r)}e.setRotation(l.Math.Between(-15,15)*Math.PI/180),e.fallSpeed=this.config.blockSpeed*this.speedMultiplier,e.blockGraphics=s,e.accountabilityType=i,this.blocks.push(e),this.trackElement(e),this.createSpawnEffect(t,this.gameArea.top,i.color)}update(t,e){const a=this.config.playerSpeed*(e/1e3);this.updatePlayerTrail(),a*(this.isMovingLeft||this.isMovingRight?1:0),this.isMovingLeft&&this.player.x>this.playerBounds.left&&(this.player.x-=a,this.addTrailParticle()),this.isMovingRight&&this.player.x<this.playerBounds.right&&(this.player.x+=a,this.addTrailParticle()),this.speedMultiplier=1+this.blocksAvoided*.1;for(let i=this.blocks.length-1;i>=0;i--){const o=this.blocks[i];o.y+=o.fallSpeed*(e/1e3),o.rotation+=.01;const s=new l.Geom.Rectangle(o.x-this.config.blockSize/2,o.y-this.config.blockSize/2,this.config.blockSize,this.config.blockSize),r=new l.Geom.Rectangle(this.player.x-15,this.player.y-15,30,30);if(l.Geom.Rectangle.Overlaps(s,r)){this.hitByBlock(o);return}if(o.y>this.gameArea.bottom&&(this.blocksAvoided++,this.updateProgress(),this.createDodgeEffect(o.x,this.gameArea.bottom),o.destroy(),this.blocks.splice(i,1),this.blocksAvoided>=this.config.blocksToDodge)){this.victory();return}}this.updateParticles(e)}updateProgress(){this.progressText.setText(`Dodged: ${this.blocksAvoided} / ${this.config.blocksToDodge}`);const t=this.blocksAvoided/this.config.blocksToDodge;t<.3?this.progressText.setColor("#FF0000"):t<.7?this.progressText.setColor("#FFAA00"):this.progressText.setColor("#00FF00")}hitByBlock(t){this.createHitEffect(t.x,t.y),this.scene.cameras.main.shake(200,.01),this.scene.tweens.add({targets:this.player,scale:[1,.8,1.2,1],duration:300,ease:"Power2"}),this.fail()}victory(){this.scene.tweens.add({targets:this.player,scale:[1,1.5,1],rotation:Math.PI*2,duration:800,ease:"Back.easeOut"}),this.createVictoryEffect(),this.success()}createSpawnEffect(t,e,a=16729344){for(let i=0;i<6;i++){const o=this.scene.add.graphics();o.fillStyle(a,1),o.fillCircle(0,0,1.5),o.x=t,o.y=e;const s=i/6*Math.PI*2,r=30;this.scene.tweens.add({targets:o,x:t+Math.cos(s)*r,y:e+Math.sin(s)*r,alpha:0,duration:400,onComplete:()=>o.destroy()})}}createDodgeEffect(t,e){const a=this.scene.add.text(t,e,"+1",{fontSize:"12px",color:"#00FF00",stroke:"#000000",strokeThickness:2}).setOrigin(.5);this.scene.tweens.add({targets:a,y:e-30,alpha:0,scale:1.5,duration:500,onComplete:()=>a.destroy()})}createHitEffect(t,e){for(let a=0;a<12;a++){const i=this.scene.add.graphics();i.fillStyle(16711680,1),i.fillCircle(0,0,3),i.x=t,i.y=e;const o=a/12*Math.PI*2,s=l.Math.Between(30,80);this.scene.tweens.add({targets:i,x:t+Math.cos(o)*s,y:e+Math.sin(o)*s,alpha:0,duration:600,onComplete:()=>i.destroy()})}}createVictoryEffect(){for(let t=0;t<20;t++){const e=this.scene.add.graphics();e.fillStyle(l.Display.Color.RandomRGB().color,1),e.fillCircle(0,0,4),e.x=this.player.x,e.y=this.player.y;const a=Math.random()*Math.PI*2,i=l.Math.Between(50,150);this.scene.tweens.add({targets:e,x:this.player.x+Math.cos(a)*i,y:this.player.y+Math.sin(a)*i,alpha:0,scale:0,duration:1e3,onComplete:()=>e.destroy()})}}addTrailParticle(){if(this.playerTrail.length<5){const t=this.scene.add.graphics();t.fillStyle(parseInt(n.COLORS.PRIMARY.replace("#","0x")),.5),t.fillCircle(0,0,3),t.x=this.player.x,t.y=this.player.y,this.playerTrail.push(t),this.scene.tweens.add({targets:t,alpha:0,scale:0,duration:300,onComplete:()=>{t.destroy(),this.playerTrail=this.playerTrail.filter(e=>e!==t)}})}}updatePlayerTrail(){}updateParticles(t){}}export{p as DodgeAccountabilityEvent};
