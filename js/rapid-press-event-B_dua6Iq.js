import{B as c}from"./base-minigame-BKAltXfh.js";class l{constructor(e,t={}){this.scene=e,this.config={key:t.key||"SPACE",targetPresses:t.targetPresses||20,timeLimit:t.timeLimit||5e3,decayRate:t.decayRate||.5,pressValue:t.pressValue||1,gaugeStyle:t.gaugeStyle||"bar",position:t.position||{x:200,y:100},showInstructions:t.showInstructions!==!1,showKeyVisualization:!1,...t},this.onProgress=t.onProgress||(()=>{}),this.onComplete=t.onComplete||(()=>{}),this.onTimeout=t.onTimeout||(()=>{}),this.onKeyPress=t.onKeyPress||(()=>{}),this.currentProgress=0,this.totalPresses=0,this.isActive=!1,this.lastPressTime=0,this.keyHandler=null,this.keyUpHandler=null,this.updateTimer=null,this.timeoutTimer=null,this.elements=[],this.animations=[],this.keyPressed=!1}start(){return this.isActive=!0,this.currentProgress=0,this.totalPresses=0,this.keyPressed=!1,this.lastPressTime=this.scene.time.now,this.setupKeyHandler(),this.createGauge(),this.createInstructions(),this.setupTimers(),this}setupKeyHandler(){this.keyHandler=e=>{this.isActive&&e.key.toUpperCase()===this.config.key.toUpperCase()&&(this.keyPressed||(this.keyPressed=!0,this.handleKeyPress()))},this.keyUpHandler=e=>{this.isActive&&e.key.toUpperCase()===this.config.key.toUpperCase()&&(this.keyPressed=!1)},this.scene.input.keyboard.on("keydown",this.keyHandler),this.scene.input.keyboard.on("keyup",this.keyUpHandler)}handleKeyPress(){this.totalPresses++,this.currentProgress+=this.config.pressValue,this.lastPressTime=this.scene.time.now,this.currentProgress=Math.min(this.currentProgress,this.config.targetPresses),this.updateGauge(),this.createPressEffect(),this.onKeyPress(this.totalPresses,this.currentProgress),this.onProgress(this.currentProgress,this.config.targetPresses),this.triggerTimerShake(),this.currentProgress>=this.config.targetPresses&&this.complete()}createGauge(){const{x:e,y:t}=this.config.position;switch(this.config.gaugeStyle){case"bar":this.createBarGauge(e,t);break;case"circle":this.createCircleGauge(e,t);break;case"custom":this.createCustomGauge(e,t);break}}createBarGauge(e,t){const i=this.scene.add.rectangle(e,t,200,20,3355443).setStrokeStyle(2,0);i.setDepth(22),this.elements.push(i),this.progressBar=this.scene.add.rectangle(e-200/2,t,0,20,65280).setOrigin(0,.5),this.progressBar.setDepth(23),this.elements.push(this.progressBar);const r=this.scene.add.text(e,t-35,"PRESS RAPIDLY!",{fontSize:"12px",fontFamily:'"Press Start 2P"',color:"#FFFFFF"}).setOrigin(.5);r.setDepth(24),this.elements.push(r),this.progressText=this.scene.add.text(e,t,"0%",{fontSize:"10px",fontFamily:'"Press Start 2P"',color:"#000000"}).setOrigin(.5),this.progressText.setDepth(24),this.elements.push(this.progressText),this.gaugeWidth=200}createCircleGauge(e,t){const a=this.scene.add.circle(e,t,40,3355443).setStrokeStyle(3,0);this.elements.push(a),this.progressGraphics=this.scene.add.graphics(),this.elements.push(this.progressGraphics),this.progressText=this.scene.add.text(e,t,"0%",{fontSize:"12px",fontFamily:'"Press Start 2P"',color:"#FFFFFF"}).setOrigin(.5),this.elements.push(this.progressText);const i=this.scene.add.text(e,t-40-20,"RAPID FIRE!",{fontSize:"10px",fontFamily:'"Press Start 2P"',color:"#FFFFFF"}).setOrigin(.5);this.elements.push(i),this.gaugeRadius=40,this.gaugeCenterX=e,this.gaugeCenterY=t}createCustomGauge(e,t){switch(this.config.key.toUpperCase()){case"T":this.createTweetGauge(e,t);break;case"A":this.createExplanationGauge(e,t);break;case"Y":this.createFlexGauge(e,t);break;default:this.createBarGauge(e,t)}}createTweetGauge(e,t){const i=this.scene.add.rectangle(e,t,180,60,1942002).setStrokeStyle(2,0);this.elements.push(i),this.progressBar=this.scene.add.rectangle(e-180/2+10,t+60/2-8,0,4,65280).setOrigin(0,.5),this.elements.push(this.progressBar),this.tweetText=this.scene.add.text(e,t-10,"Typing tweet...",{fontSize:"8px",fontFamily:"Arial",color:"#FFFFFF",wordWrap:{width:160}}).setOrigin(.5),this.elements.push(this.tweetText),this.progressText=this.scene.add.text(e+180/2-10,t+60/2-10,"0/280",{fontSize:"8px",fontFamily:"Arial",color:"#FFFFFF"}).setOrigin(1),this.elements.push(this.progressText),this.gaugeWidth=160}createExplanationGauge(e,t){const i=this.scene.add.rectangle(e,t-15,200,45,2960685).setStrokeStyle(2,16766720);this.elements.push(i),this.progressBar=this.scene.add.rectangle(e-200/2+10,t-15,0,15,16766720).setOrigin(0,.5),this.elements.push(this.progressBar);const r=this.scene.add.text(e,t-45/2-6,"EXPLANATION",{fontSize:"8px",fontFamily:'"Press Start 2P"',color:"#FFFFFF"}).setOrigin(.5);this.elements.push(r);const h=this.scene.add.text(e,t+45/2-20,"INTENSITY",{fontSize:"8px",fontFamily:'"Press Start 2P"',color:"#FFFFFF"}).setOrigin(.5);this.elements.push(h);const n=["Mild","Heated","PASSIONATE!"];this.levelText=this.scene.add.text(e+200/2-2,t-13,n[0],{fontSize:"7px",fontFamily:'"Press Start 2P"',color:"#FFFFFF"}).setOrigin(1,.5),this.elements.push(this.levelText),this.gaugeWidth=180,this.levels=n}createFlexGauge(e,t){const i=this.scene.add.rectangle(e,t,140,20,128).setStrokeStyle(2,49151);this.elements.push(i);for(let h=0;h<3;h++){const n=this.scene.add.text(e-70+(h+1)*35,t-30,"❄️",{fontSize:"12px"});this.elements.push(n)}this.progressBar=this.scene.add.rectangle(e-140/2,t,0,20,49151).setOrigin(0,.5),this.elements.push(this.progressBar);const r=this.scene.add.text(e,t-35,"FLEX POWER",{fontSize:"8px",fontFamily:'"Press Start 2P"',color:"#00BFFF"}).setOrigin(.5);this.elements.push(r),this.gaugeWidth=140}updateGauge(){const e=this.currentProgress/this.config.targetPresses,t=Math.round(e*100);switch(this.config.gaugeStyle){case"bar":this.progressBar.width=this.gaugeWidth*e,this.progressText.setText(`${t}%`);break;case"circle":this.updateCircleProgress(e),this.progressText.setText(`${t}%`);break;case"custom":this.updateCustomGauge(e,t);break}const s=this.getProgressColor(e);this.progressBar&&this.progressBar.setFillStyle(s)}updateCircleProgress(e){this.progressGraphics.clear(),e>0&&(this.progressGraphics.lineStyle(6,this.getProgressColor(e)),this.progressGraphics.beginPath(),this.progressGraphics.arc(this.gaugeCenterX,this.gaugeCenterY,this.gaugeRadius-3,-Math.PI/2,-Math.PI/2+e*Math.PI*2,!1),this.progressGraphics.strokePath())}updateCustomGauge(e,t){switch(this.progressBar.width=this.gaugeWidth*e,this.config.key.toUpperCase()){case"T":this.progressText.setText(`${Math.round(e*280)}/280`);break;case"A":const s=Math.min(Math.floor(e*this.levels.length),this.levels.length-1);this.levelText.setText(this.levels[s]);break}}getProgressColor(e){return e<.3?16711680:e<.6?16776960:e<.9?65280:65535}triggerTimerShake(){this.scene.timerDisplay&&this.scene.timerDisplay.shakeKey&&this.scene.timerDisplay.shakeKey()}createPressEffect(){const e=this.config.position.x+(Math.random()-.5)*40,t=this.config.position.y+(Math.random()-.5)*20,s=this.scene.add.text(e,t,"+1",{fontSize:"10px",fontFamily:'"Press Start 2P"',color:"#00FF00"}).setOrigin(.5);this.scene.tweens.add({targets:s,y:t-20,alpha:0,duration:500,onComplete:()=>s.destroy()})}createInstructions(){if(!this.config.showInstructions)return;const e=this.scene.add.text(this.config.position.x,this.config.position.y+60,`Rapidly press ${this.config.key.toUpperCase()}!`,{fontSize:"8px",fontFamily:'"Press Start 2P"',color:"#CCCCCC"}).setOrigin(.5);e.setDepth(24),this.elements.push(e)}setupTimers(){this.updateTimer=this.scene.time.addEvent({delay:100,repeat:-1,callback:()=>this.updateDecay()}),this.config.timeLimit>0&&(this.timeoutTimer=this.scene.time.delayedCall(this.config.timeLimit,()=>{this.timeout()}))}updateDecay(){if(!this.isActive)return;if(this.scene.time.now-this.lastPressTime>1e3){const t=this.config.decayRate*.1;this.currentProgress=Math.max(0,this.currentProgress-t),this.updateGauge(),this.currentProgress<=0&&this.totalPresses>0&&this.timeout()}}complete(){this.isActive=!1,this.cleanup(),this.onComplete()}timeout(){this.isActive=!1,this.cleanup(),this.onTimeout()}getProgress(){return{current:this.currentProgress,target:this.config.targetPresses,percentage:this.currentProgress/this.config.targetPresses*100,totalPresses:this.totalPresses}}cleanup(){this.isActive=!1,this.keyHandler&&(this.scene.input.keyboard.off("keydown",this.keyHandler),this.keyHandler=null),this.keyUpHandler&&(this.scene.input.keyboard.off("keyup",this.keyUpHandler),this.keyUpHandler=null),this.updateTimer&&(this.updateTimer.remove(),this.updateTimer=null),this.timeoutTimer&&(this.timeoutTimer.remove(),this.timeoutTimer=null),this.animations.forEach(e=>{e.stop&&e.stop()}),this.animations=[],this.elements.forEach(e=>{e&&e.destroy&&e.destroy()}),this.elements=[]}}class p extends c{constructor(e,t,s){super(e,t,s),this.rapidPress=null,this.progressDisplay=null}async start(){const e=this.getEventConfig();this.setupStandardEventSpace(e),this.createCustomInterface(),this.setupRapidPress(),this.playIntroAnimation(e.introAnimation||"fadeIn"),this.isActive=!0}getEventConfig(){return{title:"Rapid Press Event",instructions:"Rapidly press the key!",backgroundColor:1710618,introAnimation:"fadeIn",successAnimation:"standard",decorations:[]}}getRapidPressConfig(){return{key:"SPACE",targetPresses:20,decayRate:1,gaugeStyle:"bar",position:{x:this.eventArea.x+this.eventArea.width/2,y:this.eventArea.y+this.eventArea.height-50}}}createCustomInterface(){this.progressDisplay=this.createProgressDisplay("Progress: 0%")}setupRapidPress(){const e=this.getRapidPressConfig();this.rapidPress=new l(this.scene,{...e,timeLimit:this.config.timeout||7e3,showInstructions:!1,showKeyVisualization:!1,onProgress:(t,s)=>this.onProgressUpdate(t,s),onKeyPress:(t,s)=>this.onKeyPress(t,s),onComplete:()=>this.onRapidPressComplete(),onTimeout:()=>this.timeout()}),this.addMechanic(this.rapidPress),this.rapidPress.start()}onProgressUpdate(e,t){const s=Math.round(e/t*100);this.progressDisplay&&this.progressDisplay.setText(`Progress: ${e}/${t} (${s}%)`),this.handleProgressUpdate(e,t,s)}onKeyPress(e,t){this.createPressEffect(),this.handleKeyPress(e,t)}onRapidPressComplete(){const e=this.getEventConfig();this.playSuccessAnimation(e.successAnimation||"standard"),this.handleCompletion(),this.success()}createPressEffect(){const e=this.eventArea.x+this.eventArea.width/2+(Math.random()-.5)*80,t=this.eventArea.y+this.eventArea.height/2+(Math.random()-.5)*40,s=this.scene.add.text(e,t,"+1",{fontSize:"10px",fontFamily:'"Press Start 2P"',color:"#00FF00"}).setOrigin(.5).setDepth(100);this.scene.tweens.add({targets:s,y:t-20,alpha:0,duration:500,onComplete:()=>s.destroy()})}handleProgressUpdate(e,t,s){}handleKeyPress(e,t){}handleCompletion(){}updateGaugeText(e){this.progressDisplay&&this.progressDisplay.setText(e)}getCurrentProgress(){return this.rapidPress?this.rapidPress.getProgress():{current:0,target:1,percentage:0}}timeout(){this.isActive=!1,this.cleanup(),this.scene.eventManager&&this.scene.eventManager.eventFailed()}cleanup(){this.rapidPress&&this.rapidPress.cleanup(),super.cleanup()}}export{p as R};
