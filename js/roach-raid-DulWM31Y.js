import{B as h}from"./base-minigame-BKAltXfh.js";import{T as d}from"./timer-BgpETdvb.js";import{K as i}from"./game-scene-DCB2v7zZ.js";import{C as l}from"./index-c0fuZDJO.js";class k extends h{constructor(e,t,s){super(e,t,s),this.sequence=[],this.sequenceIndex=0,this.arrowKeys=[],this.keyHandler=null}async start(){this.isActive=!0,this.gameState.timeStarted=this.scene.time.now,this.setupEventSpace(),this.generateSequence(),this.setupInput(),this.setupTimer(),this.showIntroAnimation()}setupEventSpace(){this.createBackground(1710618,parseInt(this.config.color.replace("#","0x"))),this.createTitle("🪳 ROACH RAID! 🪳"),this.createRoachDecorations()}createRoachDecorations(){for(let e=0;e<6;e++){const t=this.scene.add.text(this.eventArea.x+Phaser.Math.Between(20,this.eventArea.width-20),this.eventArea.y+Phaser.Math.Between(40,this.eventArea.height-60),"🪳",{fontSize:"16px"}).setOrigin(.5);this.trackElement(t);const s=this.scene.tweens.add({targets:t,angle:[-15,15],x:t.x+Phaser.Math.Between(-15,15),y:t.y+Phaser.Math.Between(-10,10),duration:Phaser.Math.Between(800,1500),repeat:-1,yoyo:!0,delay:e*200});this.trackTween(s)}}generateSequence(){const e=["LEFT","UP","RIGHT","DOWN"],t=Phaser.Math.Between(4,6);for(let s=0;s<t;s++)this.sequence.push(Phaser.Utils.Array.GetRandom(e));this.createSequenceDisplay()}createSequenceDisplay(){const e=this.eventArea.x+this.eventArea.width/2,t=this.eventArea.y+this.eventArea.height/2,s=45,n=e-(this.sequence.length-1)*s/2;this.sequence.forEach((a,o)=>{const r=i.createLetterKey(a,{scale:1.2,style:"default",animation:"none"}),c=r.create(this.scene,n+o*s,t);this.trackElement(c),this.arrowKeys.push({keyObject:r,container:c,direction:a,completed:!1})}),this.createInstructions("Press the arrow keys in sequence!"),this.progressDisplay=this.createProgressDisplay("Progress: 0 / "+this.sequence.length)}setupInput(){this.keyHandler=e=>{if(!this.isActive)return;const s={ArrowLeft:"LEFT",ArrowUp:"UP",ArrowRight:"RIGHT",ArrowDown:"DOWN"}[e.code];s&&this.handleDirectionInput(s)},this.scene.input.keyboard.on("keydown",this.keyHandler),this.trackHandler("keydown",this.keyHandler)}handleDirectionInput(e){const t=this.sequence[this.sequenceIndex];e===t?(this.markArrowComplete(this.sequenceIndex),this.sequenceIndex++,this.updateProgress(this.sequenceIndex,this.sequence.length,this.progressDisplay),this.sequenceIndex>=this.sequence.length?this.raidSuccess():this.playSound("correct_beep",{volume:.5})):this.wrongInput()}markArrowComplete(e){const t=this.arrowKeys[e];if(t&&!t.completed){t.completed=!0,t.keyObject.style="success",t.keyObject.destroy();const s=i.createLetterKey(t.direction,{scale:.8,style:"success",animation:"pulse"}),n=s.create(this.scene,t.container.x,t.container.y);this.trackElement(n),t.keyObject=s,t.container=n,this.scene.tweens.add({targets:n,scale:[1.3,1],duration:200,ease:"Back.easeOut"}),this.createArrowCompleteEffect(n.x,n.y)}}createArrowCompleteEffect(e,t){for(let s=0;s<4;s++){const n=this.scene.add.text(e,t,"✨",{fontSize:"8px"}),a=Math.PI*2/4*s;this.scene.tweens.add({targets:n,x:e+Math.cos(a)*20,y:t+Math.sin(a)*20,alpha:0,duration:400,onComplete:()=>n.destroy()})}}wrongInput(){this.arrowKeys.forEach(e=>{if(!e.completed){e.keyObject.destroy();const t=i.createLetterKey(e.direction,{scale:.8,style:"danger",animation:"none"}),s=t.create(this.scene,e.container.x,e.container.y);this.trackElement(s),e.keyObject=t,e.container=s,this.createShakeEffect(s,3,200)}}),this.scene.time.delayedCall(300,()=>{this.fail()})}setupTimer(){const e=new d(this.scene,{duration:this.config.timeout||5e3,position:{x:this.eventArea.x+this.eventArea.width-50,y:this.eventArea.y+20},style:"bar",color:16711680,onTimeout:()=>this.timeout()});this.addMechanic(e),e.start()}showIntroAnimation(){this.arrowKeys.forEach((e,t)=>{e.container.setAlpha(0),this.scene.tweens.add({targets:e.container,alpha:1,scale:[0,1],duration:300,delay:t*150,ease:"Back.easeOut"})}),this.scene.time.delayedCall(500,()=>{const e=this.scene.add.text(this.eventArea.x+this.eventArea.width/2,this.eventArea.y+35,"🪳 COMBO THE ROACH BRIGADING ! 🪳",{fontSize:"8px",color:"#FF0000",fontFamily:'"Press Start 2P"',stroke:"#000000",strokeThickness:1}).setOrigin(.5).setAlpha(0);this.trackElement(e),this.scene.tweens.add({targets:e,alpha:[0,1,0],scale:[1,1.1,1],duration:1500})})}raidSuccess(){const e=this.eventArea.x+this.eventArea.width/2,t=this.eventArea.y+this.eventArea.height/2,s=this.scene.add.text(e,t-60,"🏆 BRIGADING BLOCKED! 🏆",{fontSize:"10px",fontFamily:'"Press Start 2P"',color:"#FFD700",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setAlpha(0);this.trackElement(s),this.scene.tweens.add({targets:s,alpha:1,y:t,scale:[0,1.2,1],duration:800,ease:"Back.easeOut"}),this.createRoachCelebration(),this.scene.chatManager&&this.scene.chatManager.addSystemMessage("Roach brigading successfully blocked! 🪳",l.COLORS.ROACH),this.scene.time.delayedCall(1e3,()=>this.success())}createRoachCelebration(){const e=this.eventArea.x+this.eventArea.width/2,t=this.eventArea.y+this.eventArea.height/2;for(let s=0;s<8;s++){const n=this.scene.add.text(e,t+20,"🪳",{fontSize:"14px"}),a=Math.PI*2/8*s;this.scene.tweens.add({targets:n,x:e+Math.cos(a)*40,y:t+20+Math.sin(a)*30,angle:360,duration:600,delay:s*100,onComplete:()=>n.destroy()})}for(let s=0;s<12;s++){const n=this.scene.add.text(e+(Math.random()-.5)*100,t,Math.random()>.5?"✨":"🎉",{fontSize:"10px"});this.scene.tweens.add({targets:n,y:t-40,alpha:0,duration:1e3,delay:Math.random()*500,onComplete:()=>n.destroy()})}}cleanup(){this.keyHandler&&this.scene.input.keyboard.off("keydown",this.keyHandler),this.arrowKeys.forEach(e=>{e.keyObject&&e.keyObject.destroy()}),this.arrowKeys=[],super.cleanup()}static getMetadata(){return{id:"roach-raid",name:"Roach Brigading",description:"Press arrow keys in sequence to block the roach invasion",difficulty:3,category:"sequence",mechanics:["timer","input-sequence"],estimatedDuration:5e3,author:"PirateSoftware",tags:["roaches","sequence","arrows","invasion"]}}}export{k as RoachRaidMinigame};
