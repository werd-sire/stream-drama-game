import{B as d}from"./base-minigame-BKAltXfh.js";import{T as g}from"./timer-BgpETdvb.js";import{C as n,J as l}from"./index-c0fuZDJO.js";class c{constructor(t,e={}){this.scene=t,this.config={x:e.x||0,y:e.y||0,width:e.width||200,height:e.height||20,min:e.min||0,max:e.max||100,value:e.value||50,step:e.step||1,trackColor:e.trackColor||6710886,knobColor:e.knobColor||16777215,fillColor:e.fillColor||65280,showValue:e.showValue!==!1,...e},this.onValueChange=e.onValueChange||(()=>{}),this.onComplete=e.onComplete||(()=>{}),this.targetValue=e.targetValue||null,this.tolerance=e.tolerance||5,this.isDragging=!1,this.knob=null,this.track=null,this.fill=null,this.valueText=null,this.container=null,this.currentAnimation=null}create(){this.container=this.scene.add.container(this.config.x,this.config.y),this.track=this.scene.add.graphics(),this.track.fillStyle(this.config.trackColor,1),this.track.fillRoundedRect(0,0,this.config.width,this.config.height,this.config.height/2),this.container.add(this.track),this.fill=this.scene.add.graphics(),this.container.add(this.fill),this.updateFill();const t=this.config.height*1.5;return this.knob=this.scene.add.circle(this.getKnobPosition(),this.config.height/2,t/2,this.config.knobColor),this.knob.setStrokeStyle(2,0),this.knob.setInteractive({draggable:!0,useHandCursor:!0}),this.container.add(this.knob),this.config.showValue&&(this.valueText=this.scene.add.text(this.config.width/2,-25,this.formatValue(this.config.value),{fontSize:"14px",fontFamily:'"Press Start 2P"',color:"#FFFFFF",align:"center"}).setOrigin(.5),this.container.add(this.valueText)),this.setupInteraction(),this.targetValue!==null&&this.showTargetIndicator(),this.container}setupInteraction(){this.knob.on("dragstart",()=>{this.isDragging=!0,this.knob.setScale(1.1),this.stopAnimations()}),this.knob.on("drag",(t,e,i)=>{const s=t.x-this.container.x,a=Phaser.Math.Clamp(s,0,this.config.width);this.knob.x=a;const h=a/this.config.width,r=this.config.min+h*(this.config.max-this.config.min),o=Math.round(r/this.config.step)*this.config.step;this.setValue(o,!1)}),this.knob.on("dragend",()=>{this.isDragging=!1,this.knob.setScale(1),this.targetValue!==null&&this.isTargetReached()&&this.onComplete(this.config.value)}),this.track.setInteractive(),this.track.on("pointerdown",t=>{if(!this.isDragging){this.stopAnimations();const e=t.x-this.container.x,i=Phaser.Math.Clamp(e,0,this.config.width);this.scene.tweens.add({targets:this.knob,x:i,duration:200,ease:"Power2.easeOut",onUpdate:()=>{const s=this.knob.x/this.config.width,a=this.config.min+s*(this.config.max-this.config.min),h=Math.round(a/this.config.step)*this.config.step;this.setValue(h,!1)},onComplete:()=>{this.targetValue!==null&&this.isTargetReached()&&this.onComplete(this.config.value)}})}})}setValue(t,e=!0){const i=this.config.value;if(this.config.value=Phaser.Math.Clamp(t,this.config.min,this.config.max),e){const s=(this.config.value-this.config.min)/(this.config.max-this.config.min);this.knob.x=s*this.config.width}this.updateFill(),this.valueText&&this.valueText.setText(this.formatValue(this.config.value)),i!==this.config.value&&this.onValueChange(this.config.value,i)}getValue(){return this.config.value}setTargetValue(t,e=null){this.targetValue=t,e!==null&&(this.tolerance=e),this.showTargetIndicator()}showTargetIndicator(){if(this.targetValue===null)return;const e=(this.targetValue-this.config.min)/(this.config.max-this.config.min)*this.config.width;this.targetIndicator&&this.targetIndicator.destroy();const i=this.tolerance/(this.config.max-this.config.min)*this.config.width;this.targetIndicator=this.scene.add.graphics(),this.targetIndicator.fillStyle(65280,.3),this.targetIndicator.fillRect(e-i/2,0,i,this.config.height),this.targetIndicator.lineStyle(2,65280,.8),this.targetIndicator.strokeRect(e-i/2,0,i,this.config.height),this.container.addAt(this.targetIndicator,2)}isTargetReached(){return this.targetValue===null?!1:Math.abs(this.config.value-this.targetValue)<=this.tolerance}getKnobPosition(){return(this.config.value-this.config.min)/(this.config.max-this.config.min)*this.config.width}updateFill(){if(!this.fill)return;this.fill.clear();const e=(this.config.value-this.config.min)/(this.config.max-this.config.min)*this.config.width;e>0&&(this.fill.fillStyle(this.config.fillColor,.7),this.fill.fillRoundedRect(0,0,e,this.config.height,this.config.height/2))}formatValue(t){return this.config.suffix?`${Math.round(t)}${this.config.suffix}`:Math.round(t).toString()}animateToValue(t,e=500){this.stopAnimations();const i=this.config.value,s=Phaser.Math.Clamp(t,this.config.min,this.config.max);this.currentAnimation=this.scene.tweens.add({targets:{value:i},value:s,duration:e,ease:"Power2.easeOut",onUpdate:a=>{this.setValue(a.targets[0].value)},onComplete:()=>{this.currentAnimation=null,this.targetValue!==null&&this.isTargetReached()&&this.onComplete(this.config.value)}})}stopAnimations(){this.currentAnimation&&(this.currentAnimation.stop(),this.currentAnimation=null)}setEnabled(t){t?(this.knob.setInteractive({draggable:!0,useHandCursor:!0}),this.track.setInteractive()):(this.knob.disableInteractive(),this.track.disableInteractive(),this.stopAnimations()),this.knob.setAlpha(t?1:.5)}destroy(){this.container&&this.container.destroy()}static create(t,e){return new c(t,e).create()}}class T extends d{constructor(t,e,i){super(t,e,i),this.centerX=this.eventArea.x+this.eventArea.width/2,this.centerY=this.eventArea.y+this.eventArea.height/2,this.targetPitch=80,this.tolerance=10}parseColor(t){return!t||typeof t!="string"?16777215:t.startsWith("#")?parseInt(t.replace("#","0x")):16777215}async start(){this.isActive=!0,this.gameState.timeStarted=this.scene.time.now,this.setupEventSpace(),this.createVoiceSlider(),this.setupTimeout(),this.showIntroAnimation()}setupEventSpace(){this.createBackground(1710618,this.parseColor(this.config.color)),this.createTitle(`Voice changing!
Slide to pirate pitch`),this.createInstructions("Find the right pitch!")}createVoiceSlider(){this.voiceSlider=new c(this.scene,{x:this.centerX-100,y:this.centerY-10,width:200,height:20,min:0,max:100,value:20,step:2,trackColor:3355443,knobColor:this.parseColor(this.config.color),fillColor:4286945,showValue:!0,suffix:"%",targetValue:this.targetPitch,tolerance:this.tolerance,onValueChange:t=>this.updateVoicePitch(t),onComplete:()=>this.handleSuccess()}),this.sliderContainer=this.voiceSlider.create(),this.trackElement(this.sliderContainer),this.createSliderLabels(),this.createPitchIndicator()}setupTimeout(){const t=new g(this.scene,{duration:this.config.timeout||4500,position:{x:this.eventArea.x+this.eventArea.width-50,y:this.eventArea.y+20},style:"bar",color:16711680,onTimeout:()=>this.timeout()});this.addMechanic(t),t.start(),this.createVoiceVisualizer()}createSliderLabels(){const t=this.scene.add.text(this.centerX-100,this.centerY+25,"NORMAL",{...n.TEXT_STYLES.MICRO,color:"#FFFFFF"}).setOrigin(0,0);this.trackElement(t);const e=this.scene.add.text(this.centerX+100,this.centerY+25,"PIRATE",{...n.TEXT_STYLES.MICRO,color:this.config.color}).setOrigin(1,0);this.trackElement(e);const i=this.scene.add.text(this.centerX+60,this.centerY-40,`TARGET
ZONE`,{...n.TEXT_STYLES.MICRO,color:"#00FF00",align:"center",fontSize:"8px"}).setOrigin(.5);this.trackElement(i)}createPitchIndicator(){this.pitchText=this.scene.add.text(this.centerX,this.centerY+40,"PITCH: LOW",{...n.TEXT_STYLES.UI_SMALL,color:"#FF0000"}).setOrigin(.5),this.trackElement(this.pitchText),this.pitchPercent=this.scene.add.text(this.centerX,this.centerY+50,"20%",{...n.TEXT_STYLES.MICRO,color:"#FFFFFF"}).setOrigin(.5),this.trackElement(this.pitchPercent)}createVoiceVisualizer(){this.voiceWaves=[];for(let t=0;t<5;t++){const e=this.scene.add.rectangle(this.centerX-60+t*30,this.centerY+70,4,10,6710886);this.voiceWaves.push(e),this.trackElement(e)}}showIntroAnimation(){this.voiceSlider.setValue(this.targetPitch),this.scene.time.delayedCall(500,()=>{this.voiceSlider.animateToValue(20,1500),this.scene.time.delayedCall(1600,()=>{this.voiceSlider.isDragging||(this.shakeTimer=this.scene.time.addEvent({delay:100,repeat:-1,callback:()=>{if(!this.voiceSlider.isDragging&&this.voiceSlider.getValue()<30){const e=this.voiceSlider.getValue()+Phaser.Math.Between(-2,2);this.voiceSlider.setValue(Phaser.Math.Clamp(e,15,25))}}}),this.trackTimer(this.shakeTimer)),this.showHint()})})}showHint(){const t=this.scene.add.text(this.centerX,this.centerY+90,"Drag to the green zone for pirate voice!",{...n.TEXT_STYLES.MICRO,color:"#FFD700"}).setOrigin(.5).setAlpha(0);this.trackElement(t),this.scene.tweens.add({targets:t,alpha:[0,1,1,0],duration:3e3})}updateVoicePitch(t){this.shakeTimer&&(this.shakeTimer.remove(),this.shakeTimer=null);let e,i;t<30?(e="LOW",i="#FF0000"):t<50?(e="MEDIUM",i="#FFAA00"):t<70?(e="HIGH",i="#FFFF00"):t<this.targetPitch-this.tolerance?(e="GETTING PIRATEY",i="#00AAFF"):this.voiceSlider.isTargetReached()?(e="PERFECT PIRATE!",i=this.config.color,this.createSparkleEffect()):(e="ALMOST PIRATE",i="#00FF00"),this.pitchText&&this.pitchText.scene&&(this.pitchText.setText(`PITCH: ${e}`),this.pitchText.setColor(i)),this.pitchPercent&&this.pitchPercent.scene&&this.pitchPercent.setText(`${Math.round(t)}%`),this.updateVoiceVisualizer(t),t>75&&this.createPirateEffect(),this.voiceSlider.isTargetReached()&&(!this.lastPitchSound||this.scene.time.now-this.lastPitchSound>500)&&(l.play(this.scene,"voice_slide",{volume:.3,startFreq:300+t*2,endFreq:200+t}),this.lastPitchSound=this.scene.time.now)}updateVoiceVisualizer(t){this.voiceWaves.forEach((e,i)=>{const h=t/100*3,r=10+Math.sin(this.scene.time.now*.01+i)*h,o=Phaser.Math.Clamp(r,5,40);e.height=o,t<30?e.setFillStyle(16711680):t<70?e.setFillStyle(16776960):e.setFillStyle(this.parseColor(this.config.color))})}createSparkleEffect(){if(this.lastSparkleTime&&this.scene.time.now-this.lastSparkleTime<300)return;this.lastSparkleTime=this.scene.time.now;const t=this.scene.add.text(this.centerX+(Math.random()-.5)*60,this.centerY+(Math.random()-.5)*30,"âœ¨",{fontSize:"16px"});this.scene.tweens.add({targets:t,y:t.y-30,alpha:0,scale:[1,1.5,0],duration:1e3,onComplete:()=>t.destroy()})}createPirateEffect(){if(this.lastPirateTime&&this.scene.time.now-this.lastPirateTime<1e3)return;this.lastPirateTime=this.scene.time.now;const t=["Yarr!","Ahoy!","Avast!","Arr!"],e=Phaser.Utils.Array.GetRandom(t),i=this.scene.add.text(this.centerX+(Math.random()-.5)*80,this.centerY-80,e,{...n.TEXT_STYLES.UI_SMALL,color:this.config.color,fontSize:"12px"}).setOrigin(.5);this.scene.tweens.add({targets:i,y:i.y-20,alpha:0,duration:800,onComplete:()=>i.destroy()})}handleSuccess(){this.pitchText.setText("PERFECT PIRATE VOICE!"),this.pitchText.setColor(this.config.color),this.scene.tweens.add({targets:this.pitchText,scale:[1,1.3,1],duration:500,repeat:2}),this.voiceSlider.setEnabled(!1);for(let t=0;t<5;t++)this.scene.time.delayedCall(t*150,()=>{this.createSparkleEffect(),t<3&&this.createPirateEffect()});this.scene.chatManager&&this.scene.chatManager.addSystemMessage("Voice changed to PIRATE! Yarr matey!",this.config.color),l.play(this.scene,"voice_slide",{volume:.5,startFreq:400,endFreq:100}),this.scene.time.delayedCall(1500,()=>{this.success()})}timeout(){this.voiceSlider&&this.voiceSlider.setEnabled(!1),super.timeout()}static getMetadata(){return{id:"voice-slide",name:"Voice Slide",description:"Slide to change voice pitch to pirate",difficulty:1,category:"slider",mechanics:["slider"],estimatedDuration:5e3,author:"PirateSoftware",tags:["voice","slider","pirate","pitch"]}}}export{T as VoiceSlideMinigame};
