class a{constructor(i,s={}){this.scene=i,this.config={requiredClicks:s.requiredClicks||1,timeout:s.timeout||0,allowMultipleTargets:s.allowMultipleTargets!==!1,clickFeedback:s.clickFeedback!==!1,...s},this.onTargetClick=s.onTargetClick||(()=>{}),this.onComplete=s.onComplete||(()=>{}),this.onTimeout=s.onTimeout||(()=>{}),this.targets=[],this.clickCount=0,this.timeoutTimer=null}start(){return this.config.timeout>0&&this.setupTimeout(),this}createTarget(i,s,e,t={}){return e.x=i,e.y=s,e.type==="Container"&&e.setSize(60,60),e.setInteractive({useHandCursor:!0}),e.metadata={clickable:!0,clicked:!1,...t},e.on("pointerdown",()=>{this.handleTargetClick(e)}),this.config.clickFeedback&&(e.on("pointerover",()=>{e.setScale(1.1)}),e.on("pointerout",()=>{e.setScale(1)})),this.targets.push(e),e}createMovingTarget(i,s,e,t,c,o={}){const n=this.createTarget(i,s,c,o.metadata),l={duration:o.duration||3e3,ease:o.ease||"Linear",repeat:o.repeat||0,yoyo:o.yoyo||!1,...o},h=this.scene.tweens.add({targets:n,x:e,y:t,...l,onComplete:()=>{o.onReachEnd&&o.onReachEnd(n)}});return n.moveTween=h,n}createBounceTarget(i,s,e,t,c={}){const o=this.createTarget(i,s,t,c.metadata);return o.velocityX=c.velocityX||Phaser.Math.Between(100,150)*(Math.random()>.5?1:-1),o.velocityY=c.velocityY||Phaser.Math.Between(100,150)*(Math.random()>.5?1:-1),o.bounds=e,o.bounceEnabled=!0,o}updateMovingTargets(i,s){this.targets.forEach(e=>{if(e.bounceEnabled&&e.bounds){e.x+=e.velocityX*(s/1e3),e.y+=e.velocityY*(s/1e3);const t=e.width?e.width/2:25;(e.x<=e.bounds.x+t||e.x>=e.bounds.x+e.bounds.width-t)&&(e.velocityX=-e.velocityX,e.x=Phaser.Math.Clamp(e.x,e.bounds.x+t,e.bounds.x+e.bounds.width-t)),(e.y<=e.bounds.y+t||e.y>=e.bounds.y+e.bounds.height-t)&&(e.velocityY=-e.velocityY,e.y=Phaser.Math.Clamp(e.y,e.bounds.y+t,e.bounds.y+e.bounds.height-t)),e.setRotation&&(e.angle=e.velocityX*.1)}})}handleTargetClick(i){!i.metadata.clickable||i.metadata.clicked||(i.metadata.clicked=!0,this.clickCount++,this.config.clickFeedback&&this.createClickEffect(i),this.config.allowMultipleTargets||(i.metadata.clickable=!1,i.setInteractive(!1)),i.moveTween&&i.moveTween.stop(),i.bounceEnabled=!1,this.onTargetClick(i,this.clickCount),this.clickCount>=this.config.requiredClicks&&this.complete())}createClickEffect(i){if(this.scene.tweens.add({targets:i,scale:[1.2,1],duration:200,ease:"Back.easeOut"}),typeof i.setTint=="function"){const s=i.tint;i.setTint(65280),this.scene.time.delayedCall(100,()=>{i.active&&i.setTint(s)})}for(let s=0;s<5;s++){const e=this.scene.add.circle(i.x,i.y,3,16776960),t=Math.PI*2/5*s;this.scene.tweens.add({targets:e,x:i.x+Math.cos(t)*30,y:i.y+Math.sin(t)*30,alpha:0,scale:0,duration:300,onComplete:()=>e.destroy()})}}setupTimeout(){this.timeoutTimer=this.scene.time.delayedCall(this.config.timeout,()=>{this.timeout()})}complete(){this.cleanup(),this.onComplete()}timeout(){this.cleanup(),this.onTimeout()}getProgress(){return{current:this.clickCount,required:this.config.requiredClicks,percentage:this.clickCount/this.config.requiredClicks*100}}cleanup(){this.timeoutTimer&&(this.timeoutTimer.remove(),this.timeoutTimer=null),this.targets.forEach(i=>{i.moveTween&&i.moveTween.stop(),i.destroy&&i.destroy()}),this.targets=[]}}export{a as C};
