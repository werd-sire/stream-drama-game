import{C as i}from"./index-c0fuZDJO.js";class l{constructor(e,t,s){if(this.scene=e,this.config=t,this.deadline=s,this.isActive=!1,this.isCompleted=!1,this.layout=e.responsiveLayout,!this.layout)console.warn("BaseMinigame: No ResponsiveLayout available, using fallback"),this.eventArea={x:i.WIDTH*i.LAYOUT.EVENT_SPACE.x_ratio,y:i.HEIGHT*i.LAYOUT.EVENT_SPACE.y_ratio,width:i.WIDTH*i.LAYOUT.EVENT_SPACE.width_ratio,height:i.HEIGHT*i.LAYOUT.EVENT_SPACE.height_ratio,margin:Math.min(i.WIDTH,i.HEIGHT)*i.LAYOUT.EVENT_SPACE.MARGIN_RATIO};else{const a=this.layout.getLayout();this.eventArea=a.eventSpace}this.elements=[],this.mechanics=[],this.timers=[],this.tweens=[],this.handlers=[],this.gameState={score:0,progress:0,lives:1,timeStarted:0}}async start(){throw new Error("Minigame must implement start() method")}update(e,t){this.mechanics.forEach(s=>{s.update&&s.update(e,t)})}success(){this.isCompleted||(this.isCompleted=!0,this.cleanup(),this.scene.eventManager&&this.scene.eventManager.eventSuccess())}fail(){this.isCompleted||(this.isCompleted=!0,this.cleanup(),this.scene.eventManager&&this.scene.eventManager.eventFailed())}timeout(){this.fail()}createBackground(e=1710618,t=null){const s=this.scene.add.graphics();return s.fillStyle(e,1),s.fillRect(this.eventArea.x,this.eventArea.y,this.eventArea.width,this.eventArea.height),t&&(s.lineStyle(3,t,1),s.strokeRect(this.eventArea.x,this.eventArea.y,this.eventArea.width,this.eventArea.height)),this.trackElement(s),s}createTitle(e,t=null){const s=t||this.config.color,a=this.scene.add.text(this.eventArea.x+this.eventArea.width/2,this.eventArea.y+15,e,{...i.TEXT_STYLES.UI_SMALL,color:s}).setOrigin(.5);return this.trackElement(a),a}createInstructions(e,t=null){const s=t||this.eventArea.y+this.eventArea.height-15,a=this.scene.add.text(this.eventArea.x+this.eventArea.width/2,s,e,{...i.TEXT_STYLES.MICRO,color:"#FFFFFF"}).setOrigin(.5);return this.trackElement(a),a}createProgressDisplay(e="Progress: 0%"){const t=this.scene.add.text(this.eventArea.x+this.eventArea.width/2,this.eventArea.y+35,e,{...i.TEXT_STYLES.MICRO,color:"#CCCCCC"}).setOrigin(.5);return this.trackElement(t),t}updateProgress(e,t,s){const a=Math.round(e/t*100);s.setText(`Progress: ${e}/${t} (${a}%)`),this.gameState.progress=a}shakeTimerKey(){this.scene.timerDisplay&&this.scene.timerDisplay.shakeKey&&this.scene.timerDisplay.shakeKey()}setupStandardEventSpace(e={}){const{title:t="Event",instructions:s="Complete the challenge!",backgroundColor:a=1710618,strokeColor:r=null,decorations:n=[]}=e;this.createBackground(a,r||this.parseEventColor()),this.createTitle(t),this.createInstructions(s),this.createDecorations(n)}parseEventColor(){try{if(this.config.color&&typeof this.config.color=="string")return parseInt(this.config.color.replace("#","0x"))}catch{console.warn("Failed to parse event color:",this.config.color)}return 16777215}createDecorations(e=[]){e.forEach(t=>{const s=this.createDecoration(t);s&&this.trackElement(s)})}createDecoration(e){const{type:t,x:s,y:a,...r}=e,n=this.eventArea.x+(s||0),c=this.eventArea.y+(a||0);switch(t){case"emoji":return this.scene.add.text(n,c,r.emoji,{fontSize:r.size||"16px",...r.style});case"particle":return this.createParticleDecoration(n,c,r);case"graphics":return this.createGraphicsDecoration(n,c,r);default:return console.warn("Unknown decoration type:",t),null}}createParticleDecoration(e,t,s){const a=this.scene.add.circle(e,t,s.radius||2,s.color||16777215);return s.animate&&this.scene.tweens.add({targets:a,y:t-(s.distance||50),alpha:0,duration:s.duration||2e3,repeat:-1,...s.tweenConfig}),a}createGraphicsDecoration(e,t,s){const a=this.scene.add.graphics();switch(s.shape){case"rectangle":a.fillStyle(s.color||16777215),a.fillRect(e,t,s.width||10,s.height||10);break;case"circle":a.fillStyle(s.color||16777215),a.fillCircle(e,t,s.radius||5);break}return a}playIntroAnimation(e="fadeIn",t=400){var a;const s={fadeIn:()=>this.createFadeIn(t),slideUp:()=>this.createSlideIn("up",t),slideDown:()=>this.createSlideIn("down",t),bounce:()=>this.createBounceIn(t),scale:()=>this.createScaleIn(t)};return((a=s[e])==null?void 0:a.call(s))||s.fadeIn()}createFadeIn(e=400){this.elements.forEach(t=>{if(t&&t.setAlpha&&typeof t.setAlpha=="function")try{t.setAlpha(0),this.scene.tweens.add({targets:t,alpha:1,duration:e,ease:"Power2.easeOut"})}catch(s){console.warn("Failed to animate element:",s)}})}createSlideIn(e="up",t=500){this.elements.forEach(s=>{if(s&&s.setPosition&&typeof s.setPosition=="function")try{const a=s.y,r=e==="up"?50:-50;s.setY(a+r),s.setAlpha&&typeof s.setAlpha=="function"&&s.setAlpha(0);const n={targets:s,y:a,duration:t,ease:"Back.easeOut"};s.setAlpha&&typeof s.setAlpha=="function"&&(n.alpha=1),this.scene.tweens.add(n)}catch(a){console.warn("Failed to animate element:",a)}})}createBounceIn(e=600){this.elements.forEach(t=>{if(t&&t.setScale&&typeof t.setScale=="function")try{t.setScale(0),t.setAlpha&&typeof t.setAlpha=="function"&&t.setAlpha(0);const s={targets:t,scaleX:1,scaleY:1,duration:e,ease:"Bounce.easeOut"};t.setAlpha&&typeof t.setAlpha=="function"&&(s.alpha=1),this.scene.tweens.add(s)}catch(s){console.warn("Failed to animate element:",s)}})}createScaleIn(e=300){this.elements.forEach(t=>{if(t&&t.setScale&&typeof t.setScale=="function")try{t.setScale(.5),t.setAlpha&&typeof t.setAlpha=="function"&&t.setAlpha(0);const s={targets:t,scaleX:1,scaleY:1,duration:e,ease:"Power2.easeOut"};t.setAlpha&&typeof t.setAlpha=="function"&&(s.alpha=1),this.scene.tweens.add(s)}catch(s){console.warn("Failed to animate element:",s)}})}playSuccessAnimation(e="standard"){var s;const t={standard:()=>this.createStandardSuccess(),explosive:()=>this.createExplosiveSuccess(),subtle:()=>this.createSubtleSuccess()};return((s=t[e])==null?void 0:s.call(t))||t.standard()}createStandardSuccess(){const e=this.scene.add.text(this.eventArea.x+this.eventArea.width/2,this.eventArea.y+this.eventArea.height/2,"SUCCESS!",{fontSize:"20px",fontFamily:'"Press Start 2P"',color:i.COLORS.SUCCESS,stroke:"#000000",strokeThickness:3}).setOrigin(.5).setDepth(1e3);return e.setScale(0),this.scene.tweens.add({targets:e,scaleX:1.2,scaleY:1.2,duration:200,ease:"Back.easeOut",onComplete:()=>{this.scene.tweens.add({targets:e,scaleX:1,scaleY:1,duration:100})}}),this.scene.time.delayedCall(1500,()=>{e&&e.destroy()}),e}createExplosiveSuccess(){this.createStandardSuccess();for(let e=0;e<8;e++){const t=e/8*Math.PI*2,s=this.scene.add.circle(this.eventArea.x+this.eventArea.width/2,this.eventArea.y+this.eventArea.height/2,3,Phaser.Utils.Array.GetRandom([16766720,65280,65535,16738740])).setDepth(999);this.scene.tweens.add({targets:s,x:s.x+Math.cos(t)*60,y:s.y+Math.sin(t)*60,alpha:0,duration:800,ease:"Power2.easeOut",onComplete:()=>s.destroy()})}}createSubtleSuccess(){this.elements.forEach(e=>{if(e&&e.setTint&&typeof e.setTint=="function")try{e.setTint(65280),this.scene.tweens.add({targets:e,duration:200,yoyo:!0,onComplete:()=>{e&&e.clearTint&&typeof e.clearTint=="function"&&e.clearTint()}})}catch(t){console.warn("Failed to tint element:",t)}})}addMechanic(e){return this.mechanics.push(e),e}removeMechanic(e){const t=this.mechanics.indexOf(e);t>-1&&(this.mechanics.splice(t,1),e.cleanup&&e.cleanup())}trackElement(e){return this.elements.push(e),e&&e.setDepth&&e.setDepth(20),e}trackTimer(e){return this.timers.push(e),e}trackTween(e){return this.tweens.push(e),e}trackHandler(e,t){return this.handlers.push({eventName:e,handler:t}),t}createGraphics(){const e=this.scene.add.graphics();return this.trackElement(e),e}createBounceEffect(e,t=1.2,s=300){const a=this.scene.tweens.add({targets:e,scale:[t,1],duration:s,ease:"Back.easeOut"});return this.trackTween(a),a}createShakeEffect(e,t=5,s=300){const a=e.x,r=this.scene.tweens.add({targets:e,x:[a+t,a-t,a+t,a-t,a],duration:s,onComplete:()=>{e.x=a}});return this.trackTween(r),r}playSound(e,t={}){if(this.scene.sound&&this.scene.sound.add)return this.scene.sound.add(e,t)}checkInput(e,t){return!1}cleanup(){this.isActive=!1,this.mechanics.forEach(e=>{e.cleanup&&e.cleanup()}),this.mechanics=[],this.elements.forEach(e=>{e&&e.destroy&&e.destroy()}),this.elements=[],this.timers.forEach(e=>{e&&e.remove&&e.remove()}),this.timers=[],this.tweens.forEach(e=>{e&&e.stop&&e.stop()}),this.tweens=[],this.handlers.forEach(({eventName:e,handler:t})=>{this.scene.input&&this.scene.input.keyboard&&this.scene.input.keyboard.off(e,t)}),this.handlers=[]}static getMetadata(){return{id:"base-minigame",name:"Base Minigame",description:"Base class for all minigames",difficulty:1,category:"base",mechanics:[],estimatedDuration:5e3,author:"System"}}}export{l as B};
